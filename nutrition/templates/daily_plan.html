{% extends "base.html" %}

{% comment %}
  web_nutrition: a web based nutrition and diet analysis program.
  Copyright (C) 2008 Edgar Denny

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as
  published by the Free Software Foundation, either version 3 of the
  License, or (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
{% endcomment %}

{% block title %}Daily Plan{% endblock %}</title>

{% block content %}
  <h1 class="title">Calendar</h1>
  <table border="1">
    <tr>
      <th colspan="3"><a id="year" href="/daily_plan/{{ cal.prev_year }}/{{ cal.month }}/1">prev year</a></th>
      <th>{{ cal.year|escape }}</th>
      <th colspan="3"><a id="year" href="/daily_plan/{{ cal.next_year }}/{{ cal.month }}/1">next year</a></th>
    </tr>
    <tr>
      <th colspan="3"><a id="month" href="/daily_plan/{{ cal.year }}/{{ cal.prev_month }}/1">prev month</a></th>
      <th>{{ cal.month_name|escape }}</th>
      <th colspan="3"><a id="month" href="/daily_plan/{{ cal.year }}/{{ cal.next_month }}/1">next month</a></th>
    </tr>
    <tr>
      {% for day_name in cal.day_names %}
        <td>{{ day_name }}</td>
      {% endfor %}
    </tr>
    {% for week in cal.calendar_rows %}
    <tr>
      {% for day in week %}
        {% ifequal day 0 %}
          <td></td>
        {% else %}
          <td><a id="day" href="/daily_plan/{{ cal.year }}/{{ cal.month }}/{{ day }}">{{ day|escape }}</a></td>
        {% endifequal %}
      {% endfor %}
    </tr>
    {% endfor %}
  </table>

  <h1>Daily Plan : {{ cal.year }}/{{ cal.month }}/{{ cal.day }}</h1>
  <form action="/daily_plan/{{ cal.year }}/{{ cal.month }}/{{ cal.day }}/" method="POST">
    {% ifequal save_result 0 %}
      <p>Cannot Save: correct entries highlighted with '*'</p>
    {% endifequal %}
    <input type="submit" name="refresh" value="Refresh">
    <input type="submit" name="add_recipe" value="Add Recipe">
    <input type="submit" name="add_food" value="Add Food">
    <input type="submit" name="delete" value="Delete">
    <input type="submit" name="save" value="Save">
    <br />
    <table border="1">
      <tr>
        <th></th>
        <th>Number</th>
        <th>Food Measure</th>
        <th>Name</th>
        <th>Calories</th>
      </tr>
      {% for item in plan_list %}
        <tr>
          <td>{{ item.check|escape }}
            {% if item.check.errors %}<span class="errors">*</span>{% endif %}
          </td>
          <td>{{ item.num_measures|escape }}
            {% if item.num_measures.errors %}<span class="errors">*</span>{% endif %}
          </td>
          <td>
            {% ifequal item.item_type "food" %}
              {{ item.measure|escape }}
              {% if item.measure.errors %}<span class="errors">*</span>{% endif %}
            {% else %}
              1 serving
            {% endifequal %}
          </td>
          <td>
            {% ifequal item.item_type "food" %}
              <a id="odd" href="/food_search/food_id/{{ item.item_id }}/measure/{{ item.measure_str }}/amount/{{ item.amount }}">{{ item.name_str }}</a>
            {% else %}
              <a id="odd" href="/search_recipe/recipe_id/{{ item.item_id }}">{{ item.name_str }}</a>
            {% endifequal %}
              {% if item.name.errors %}<span class="errors">*</span>{% endif %}
          </td>
          <td>
            {{ item.calories }}
          </td>
        </tr>
      {% endfor %}
    </table>
  </form>

  {% if nutrients.general %}
    <h3>Macro Nutrients</h3>
    <table border="1">
      {% for n in nutrients.general %}
         <tr>
           <td>{{ n.nutr_desc|escape }}</td>
           <td>{{ n.nutr_value|escape }} {{ n.unit_of_measure|escape }}</td>
           <td>{{ n.percent_rdi|stringformat:".1f" }}</td>
         </tr>
      {% endfor %}
    </table>
    <h3>Vitamins</h3>
    <table border="1">
      {% for n in nutrients.vitamins %}
         <tr>
           <td>{{ n.nutr_desc|escape }}</td>
           <td>{{ n.nutr_value|escape }} {{ n.unit_of_measure|escape }}</td>
           <td>{{ n.percent_rdi|stringformat:".1f" }}</td>
         </tr>
      {% endfor %}
    </table>
    <h3>Minerals</h3>
    <table border="1">
      {% for n in nutrients.minerals %}
         <tr>
           <td>{{ n.nutr_desc|escape }}</td>
           <td>{{ n.nutr_value|escape }} {{ n.unit_of_measure|escape }}</td>
           <td>{{ n.percent_rdi|stringformat:".1f" }}</td>
         <tr>
      {% endfor %}
    </table>
    <h3>Amino Acids</h3>
    <table border="1">
      {% for n in nutrients.amino_acids %}
         <tr>
           <td>{{ n.nutr_desc|escape }}</td>
           <td>{{ n.nutr_value|escape }} {{ n.unit_of_measure|escape }}</td>
           <td>{{ n.percent_rdi|stringformat:".1f" }}</td>
         </tr>
      {% endfor %}
    </table>
    <h3>Fats</h3>
    <table border="1">
      {% for n in nutrients.fats %}
         <tr>
           <td>{{ n.nutr_desc|escape }}</td>
           <td>{{ n.nutr_value|escape }} {{ n.unit_of_measure|escape }}</td>
           <td>{{ n.percent_rdi|stringformat:".1f" }}</td>
         </tr>
      {% endfor %}
    </table>
  {% endif %}
{% endblock %}
